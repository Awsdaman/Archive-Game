<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ | The Archive Round</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0e;--surface:#111117;--surface2:#18181f;--surface3:#1e1e27;
  --accent:#c8f135;--accent2:#a8d120;--accent-glow:rgba(200,241,53,0.18);
  --accent-dim:rgba(200,241,53,0.08);--text:#f2f2f2;--text-dim:#777;
  --red:#ff4455;--red-dim:rgba(255,68,85,0.15);--green-dim:rgba(200,241,53,0.15);
  --border:rgba(200,241,53,0.15);--border2:rgba(255,255,255,0.07);
}
body{font-family:'Cairo',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body.ltr{direction:ltr;font-family:'Oswald','Cairo',sans-serif}
.view{display:none;min-height:100vh;animation:fadeIn .35s ease}
.view.active{display:flex;flex-direction:column}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");pointer-events:none;z-index:9999}

.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--border2);flex-shrink:0}
.logo{font-family:'Oswald',sans-serif;font-size:14px;font-weight:700;letter-spacing:3px;color:var(--accent);text-transform:uppercase}
.lang-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text-dim);padding:5px 13px;border-radius:20px;cursor:pointer;font-family:inherit;font-size:12px;transition:.2s}
.lang-btn:hover{color:var(--accent);border-color:var(--accent)}

input,select{background:var(--surface2);border:1px solid var(--border2);border-radius:8px;padding:10px 13px;color:var(--text);font-family:inherit;font-size:14px;outline:none;transition:.2s;width:100%}
input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-dim)}
input::placeholder{color:#3a3a3a}
select option{background:var(--surface2);color:var(--text)}
label{font-size:12px;color:var(--text-dim);display:block;margin-bottom:5px}
.field{display:flex;flex-direction:column;gap:5px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}

.btn-primary{background:var(--accent);color:#0a0a0e;font-family:'Oswald',sans-serif;font-size:15px;font-weight:700;letter-spacing:2px;text-transform:uppercase;border:none;border-radius:8px;padding:14px;cursor:pointer;transition:.2s;width:100%}
.btn-primary:hover{background:var(--accent2);transform:translateY(-1px);box-shadow:0 6px 20px var(--accent-glow)}
.btn-secondary{background:transparent;color:var(--text-dim);border:1px solid var(--border2);border-radius:8px;padding:9px 18px;cursor:pointer;font-family:inherit;font-size:13px;transition:.2s}
.btn-secondary:hover{border-color:var(--accent);color:var(--accent)}
.btn-danger{background:var(--red-dim);color:var(--red);border:1px solid rgba(255,68,85,0.25);border-radius:6px;padding:5px 10px;cursor:pointer;font-size:11px;font-family:inherit;transition:.2s;white-space:nowrap}
.btn-danger:hover{background:rgba(255,68,85,0.25)}

/* SETUP */
#view-setup{overflow-y:auto}
.setup-inner{max-width:560px;width:100%;margin:0 auto;padding:24px 20px 60px;display:flex;flex-direction:column;gap:14px}
.setup-hero{text-align:center;padding:16px 0 20px}
.setup-hero h1{font-family:'Oswald',sans-serif;font-size:clamp(2rem,7vw,3.2rem);font-weight:700;letter-spacing:3px;text-transform:uppercase;line-height:1}
.setup-hero h1 span{color:var(--accent)}
.setup-hero p{color:var(--text-dim);font-size:13px;margin-top:8px}
.sec-card{background:var(--surface);border:1px solid var(--border2);border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:12px}
.sec-title{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--accent);margin-bottom:2px}
.event-item{display:grid;grid-template-columns:32px 38px 1fr 56px auto;gap:7px;align-items:center}
.ev-id-badge{font-family:'Oswald',sans-serif;font-size:11px;font-weight:700;color:var(--text-dim);background:var(--surface3);border:1px solid var(--border2);border-radius:5px;padding:4px 0;text-align:center;min-width:30px}
.ev-badge{font-family:'Oswald',sans-serif;font-weight:700;font-size:11px;padding:8px 0;border-radius:6px;text-align:center;cursor:pointer;user-select:none;transition:.15s}
.ev-badge.G{background:var(--green-dim);color:var(--accent);border:1px solid rgba(200,241,53,0.3)}
.ev-badge.A{background:rgba(100,150,255,0.12);color:#88aaff;border:1px solid rgba(100,150,255,0.25)}
.add-ev-btn{display:flex;align-items:center;justify-content:center;gap:6px;background:var(--surface3);border:1px dashed var(--border2);border-radius:8px;padding:9px;cursor:pointer;font-size:12px;color:var(--text-dim);transition:.2s;width:100%;font-family:inherit}
.add-ev-btn:hover{border-color:var(--accent);color:var(--accent)}
.target-preview{background:var(--surface2);border:1px solid var(--accent);border-radius:8px;padding:10px 14px;font-size:13px;color:var(--accent);min-height:38px;display:flex;align-items:center;word-break:break-word}

/* GAME */
#view-game{overflow:hidden}
.game-header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:12px 16px;gap:10px;border-bottom:1px solid var(--border2);flex-shrink:0}
.tsb{display:flex;flex-direction:column;gap:3px;padding:8px 12px;border-radius:10px;border:1px solid transparent;transition:0.3s}
.tsb.left{align-items:flex-end;text-align:right}
.tsb.right{align-items:flex-start;text-align:left}
body.ltr .tsb.left{align-items:flex-start;text-align:left}
body.ltr .tsb.right{align-items:flex-end;text-align:right}

/* Turn Active Styling */
.tsb.active-turn { background: var(--surface2); border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
.tsb.active-turn .tsb-name { color: var(--text); }

.tsb-name{font-size:11px;font-weight:700;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:0.3s}
.tsb-pts{font-family:'Oswald',sans-serif;font-size:30px;font-weight:700;color:var(--accent);line-height:1}
.tsb-strikes{display:flex;gap:4px}
.tsb.right .tsb-strikes{flex-direction:row-reverse}
body.ltr .tsb.right .tsb-strikes{flex-direction:row}
.sdot{width:9px;height:9px;border-radius:50%;background:var(--surface3);border:1px solid var(--border2);transition:.3s}
.sdot.hit{background:var(--red);border-color:var(--red);box-shadow:0 0 6px var(--red)}
.gcenter{display:flex;flex-direction:column;align-items:center;gap:2px}
.timer{font-family:'Oswald',sans-serif;font-size:26px;font-weight:700;min-width:52px;text-align:center;transition:color .3s}
.timer.warn{color:var(--red);animation:blink .5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
.round-lbl{font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase}

.card-area{flex:1;overflow-y:auto;padding:12px}
.match-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;max-width:580px;margin:0 auto;box-shadow:0 0 40px rgba(200,241,53,0.05)}
.card-meta{display:grid;grid-template-columns:1fr 1fr}
.cmeta-cell{padding:8px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px;border-bottom:1px solid var(--border2)}
.cmeta-cell:nth-child(2){border-right:1px solid var(--border2)}
body.ltr .cmeta-cell:nth-child(2){border-right:none;border-left:1px solid var(--border2)}
.cmeta-label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text-dim);white-space:nowrap}
.card-teams{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:14px 12px;gap:8px;background:var(--surface2);border-bottom:1px solid var(--border)}
.cteam{display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center}
.cteam-name{font-size:13px;font-weight:700;line-height:1.2;word-break:break-word}
.cscore-wrap{display:flex;flex-direction:column;align-items:center;gap:3px}
.cscore-lbl{font-size:9px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase}
.cscore-val{font-family:'Oswald',sans-serif;font-size:26px;font-weight:700;color:var(--accent)}
.card-target{padding:10px 14px;border-bottom:1px solid var(--border);background:rgba(200,241,53,0.03)}
.ctarget-lbl{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--accent);margin-bottom:5px}
.card-events{display:grid;grid-template-columns:1fr 1fr}
.cevents-col{padding:8px 0}
.cevents-col:nth-child(1){border-left:1px solid var(--border)}
body.ltr .cevents-col:nth-child(1){border-left:none;border-right:1px solid var(--border)}
.cevents-head{font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text-dim);padding:0 10px 7px;text-align:center;border-bottom:1px solid var(--border2);margin-bottom:4px}

.sq{border-radius:7px;cursor:pointer;transition:.15s;user-select:none;display:flex;align-items:center;justify-content:center;font-family:'Oswald',sans-serif;font-weight:700;font-size:15px;color:var(--text-dim)}
.sq.hidden{background:var(--surface3);border:1px solid var(--border2)}
.sq.hidden:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim);box-shadow:0 0 10px var(--accent-glow)}
.sq.hidden:active{transform:scale(.96)}
.sq.locked{background:rgba(200,241,53,0.04);border:1px solid var(--accent);color:var(--accent);cursor:default;font-size:20px;box-shadow:0 0 8px rgba(200,241,53,0.12)}
/* per-type colors */
.sq-c-league  {background:rgba(120,80,255,0.12)!important;border-color:rgba(120,80,255,0.35)!important;color:#a07fff!important}
.sq-c-season  {background:rgba(255,160,40,0.1)!important;border-color:rgba(255,160,40,0.35)!important;color:#ffb347!important}
.sq-c-team    {background:rgba(40,160,255,0.1)!important;border-color:rgba(40,160,255,0.3)!important;color:#66aaff!important}
.sq-c-score   {background:rgba(200,241,53,0.08)!important;border-color:rgba(200,241,53,0.35)!important;color:var(--accent)!important}
.sq-c-goal    {background:rgba(200,241,53,0.08)!important;border-color:rgba(200,241,53,0.25)!important;color:var(--accent)!important}
.sq-c-assist  {background:rgba(40,180,255,0.08)!important;border-color:rgba(40,180,255,0.28)!important;color:#66ccff!important}
.sq-c-answer  {background:rgba(255,80,120,0.08)!important;border-color:rgba(255,80,120,0.3)!important;color:#ff7096!important}
.sq.revealed{cursor:default;animation:flip .3s ease}
@keyframes flip{from{transform:scaleY(0);opacity:0}to{transform:scaleY(1);opacity:1}}
.sq-info{flex:1;min-height:34px;padding:5px 10px}
.sq-info.revealed{font-weight:700;font-size:13px}
.sq-team{min-height:64px;width:100%;padding:8px;flex-direction:column;gap:4px}
.sq-score{min-width:72px;min-height:48px}
.sq-target{width:100%;min-height:38px;padding:7px 12px;border-radius:8px;justify-content:flex-start}
.sq-target.hidden{border:1px solid rgba(200,241,53,0.2);justify-content:center}
.sq-target.hidden:hover{border-color:var(--accent)}
.sq-target.revealed{font-family:'Cairo',sans-serif;font-weight:700;font-size:14px;color:var(--accent)}
.sq-event{margin:3px 8px;padding:7px 10px;min-height:38px;gap:8px}
.ev-type{font-family:'Oswald',sans-serif;font-weight:700;font-size:11px;padding:2px 7px;border-radius:4px;white-space:nowrap}
.ev-type.G{background:var(--green-dim);color:var(--accent)}
.ev-type.A{background:rgba(100,150,255,0.12);color:#88aaff}
.ev-player{font-weight:700;font-size:12px;flex:1;font-family:'Cairo',sans-serif}
.ev-min{font-family:'Oswald',sans-serif;font-size:11px;color:var(--text-dim);white-space:nowrap}
.no-events{padding:10px;text-align:center;color:var(--text-dim);font-size:11px}

.controls{flex-shrink:0;border-top:1px solid var(--border2);padding:10px 14px;display:flex;flex-direction:column;gap:8px}
.ctrl-row{display:flex;gap:7px;align-items:center}
.ctrl-btn{flex:1;padding:9px 6px;border-radius:7px;border:none;cursor:pointer;font-family:'Oswald',sans-serif;font-weight:700;font-size:12px;letter-spacing:1px;text-transform:uppercase;transition:.2s}
.ctrl-btn:disabled{opacity:.25;cursor:not-allowed}
.btn-correct{background:var(--green-dim);color:var(--accent);border:1px solid rgba(200,241,53,0.25)}
.btn-correct:not(:disabled):hover{background:rgba(200,241,53,0.22)}
.btn-wrong{background:var(--red-dim);color:var(--red);border:1px solid rgba(255,68,85,0.25)}
.btn-wrong:not(:disabled):hover{background:rgba(255,68,85,0.22)}
.btn-timer-ctrl{background:var(--surface2);color:var(--text);border:1px solid var(--border2)}
.btn-timer-ctrl:hover{border-color:var(--accent);color:var(--accent)}
.btn-revall{background:var(--surface2);color:var(--text-dim);border:1px solid var(--border2)}
.btn-revall:hover{color:var(--text)}
.status-bar{font-size:11px;color:var(--text-dim);text-align:center}
.status-bar.on{color:var(--accent);font-weight:700}
.team-ctrl-lbl{font-size:10px;color:var(--text-dim);text-align:center;letter-spacing:1px;text-transform:uppercase;margin-bottom:5px}
.team-btns{display:flex;gap:6px}

.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;align-items:center;justify-content:center}
.overlay.show{display:flex;animation:fadeIn .3s}
.overlay-box{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px 24px;max-width:360px;width:90%;text-align:center;display:flex;flex-direction:column;gap:14px}
.overlay-box h2{font-family:'Oswald',sans-serif;font-size:22px;font-weight:700;letter-spacing:2px}
.overlay-box h2 span{color:var(--accent)}
.overlay-box p{color:var(--text-dim);font-size:13px;line-height:1.5}
.score-disp{display:flex;justify-content:center;gap:20px;padding:8px 0}
.sd-item{display:flex;flex-direction:column;align-items:center;gap:2px}
.sd-name{font-size:11px;color:var(--text-dim)}
.sd-pts{font-family:'Oswald',sans-serif;font-size:36px;font-weight:700;color:var(--accent)}
.sd-sep{font-family:'Oswald',sans-serif;font-size:26px;color:var(--text-dim);align-self:center}
.overlay-btns{display:flex;gap:10px}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
.saved-card{background:var(--surface2);border:1px solid var(--border2);border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:12px;transition:.2s}
.saved-card:hover{border-color:var(--border)}
.saved-card-info{flex:1;min-width:0}
.saved-card-title{font-weight:700;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.saved-card-meta{font-size:11px;color:var(--text-dim);margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.saved-card-btns{display:flex;gap:6px;flex-shrink:0}
.btn-load{background:var(--accent-dim);color:var(--accent);border:1px solid var(--border);border-radius:6px;padding:6px 12px;cursor:pointer;font-family:'Oswald',sans-serif;font-size:12px;font-weight:700;letter-spacing:1px;transition:.15s}
.btn-load:hover{background:rgba(200,241,53,.18)}
.save-toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--accent);color:#0a0a0e;font-family:'Oswald',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;padding:10px 22px;border-radius:20px;z-index:300;opacity:0;transition:opacity .3s;pointer-events:none}
.save-toast.show{opacity:1}
</style>
</head>
<body>

<div id="view-setup" class="view active">
  <div class="topbar">
    <span class="logo">âš½ Archive</span>
    <button class="lang-btn" onclick="toggleLang()">EN / AR</button>
  </div>
  <div class="setup-inner">
    <div class="setup-hero">
      <h1 id="hero-title">Ø¬ÙˆÙ„Ø© <span>Ø§Ù„Ø£Ø±Ø´ÙŠÙ</span></h1>
      <p id="hero-sub">The Archive Round</p>
    </div>

    <div class="sec-card">
      <div class="sec-title" id="sec-players">Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³Ø©</div>
      <div class="row2">
        <div class="field"><label id="lbl-p1">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</label><input id="inp-p1" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‡Ù„Ø§Ù„"></div>
        <div class="field"><label id="lbl-p2">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</label><input id="inp-p2" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù†ØµØ±"></div>
      </div>
    </div>

    <div class="sec-card">
      <div class="sec-title" id="sec-match">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</div>
      <div class="row2">
        <div class="field"><label id="lbl-home">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¶ÙŠÙ</label><input id="inp-home" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø§ØªØ­Ø§Ø¯" oninput="updateTargetPreview()"></div>
        <div class="field"><label id="lbl-away">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¶ÙŠÙ</label><input id="inp-away" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ù‡Ù„ÙŠ" oninput="updateTargetPreview()"></div>
      </div>
      <div class="row3">
        <div class="field"><label id="lbl-hscore">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¶ÙŠÙ</label><input id="inp-hscore" type="number" min="0" max="20" value="0"></div>
        <div class="field"><label id="lbl-ascore">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¶ÙŠÙ</label><input id="inp-ascore" type="number" min="0" max="20" value="0"></div>
        <div class="field"><label id="lbl-season">Ø§Ù„Ù…ÙˆØ³Ù…</label><input id="inp-season" type="text" placeholder="2024/2023"></div>
      </div>
      <div class="field"><label id="lbl-league">Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</label><input id="inp-league" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±ÙŠ Ø±ÙˆØ´Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ"></div>
    </div>

    <div class="sec-card">
      <div class="sec-title" id="sec-hev">Ø£Ù‡Ø¯Ø§Ù ÙˆØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¶ÙŠÙ</div>
      <div id="list-home" style="display:flex;flex-direction:column;gap:7px"></div>
      <button class="add-ev-btn" onclick="addEvent('home')">+ <span id="lbl-addhome">Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù / ØªÙ…Ø±ÙŠØ±Ø©</span></button>
    </div>

    <div class="sec-card">
      <div class="sec-title" id="sec-aev">Ø£Ù‡Ø¯Ø§Ù ÙˆØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ø¶ÙŠÙ</div>
      <div id="list-away" style="display:flex;flex-direction:column;gap:7px"></div>
      <button class="add-ev-btn" onclick="addEvent('away')">+ <span id="lbl-addaway">Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù / ØªÙ…Ø±ÙŠØ±Ø©</span></button>
    </div>

    <div class="sec-card">
      <div class="sec-title" id="sec-target">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
      <div class="field">
        <label id="lbl-tid">Ø±Ù‚Ù… Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (#ID)</label>
        <input id="inp-tid" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 3" oninput="updateTargetPreview()">
      </div>
      <div class="target-preview" id="target-preview">Ø£Ø¶Ù Ø£Ø­Ø¯Ø§Ø«Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø«Ù… Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</div>
    </div>

    <div style="display:grid;grid-template-columns:1fr auto;gap:10px">
      <button class="btn-primary" onclick="startGame()"><span id="lbl-create">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡</span></button>
      <button class="btn-secondary" style="white-space:nowrap;padding:14px 18px" onclick="saveRound()">ğŸ’¾ <span id="lbl-save">Ø­ÙØ¸</span></button>
    </div>

    <div class="sec-card" id="saved-section" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div class="sec-title" id="sec-saved">Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</div>
        <span id="saved-count" style="font-size:11px;color:var(--text-dim)"></span>
      </div>
      <div id="saved-list" style="display:flex;flex-direction:column;gap:8px"></div>
    </div>

  </div>
</div>

<div id="view-game" class="view">
  <div class="game-header">
    <div class="tsb left" id="tsb-p1">
      <div class="tsb-name" id="gh-p1">Ù1</div>
      <div class="tsb-pts" id="gh-p1-pts">0</div>
      <div class="tsb-strikes" id="gh-p1-str"></div>
    </div>
    <div class="gcenter">
      <div class="round-lbl" id="lbl-round">Ø§Ù„Ø¬ÙˆÙ„Ø©</div>
      <div class="timer" id="timer">30</div>
    </div>
    <div class="tsb right" id="tsb-p2">
      <div class="tsb-name" id="gh-p2">Ù2</div>
      <div class="tsb-pts" id="gh-p2-pts">0</div>
      <div class="tsb-strikes" id="gh-p2-str"></div>
    </div>
  </div>

  <div class="card-area">
    <div class="match-card" id="match-card"></div>
  </div>

  <div class="controls">
    <div class="status-bar" id="status-bar">â€”</div>
    <div class="ctrl-row">
      <button class="ctrl-btn btn-timer-ctrl" onclick="toggleTimer()">â–¶ <span id="lbl-tbtn">Ø§Ø¨Ø¯Ø£</span></button>
      <button class="ctrl-btn btn-revall" onclick="revealAll()"><span id="lbl-revall">ÙƒØ´Ù Ø§Ù„ÙƒÙ„</span></button>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div>
        <div class="team-ctrl-lbl" id="ctrl-p1-lbl">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</div>
        <div class="team-btns">
          <button class="ctrl-btn btn-correct" id="b-p1-ok" onclick="markAnswer(0,true)">âœ“ <span id="lbl-ok1">ØµØ­</span></button>
          <button class="ctrl-btn btn-wrong"   id="b-p1-no" onclick="markAnswer(0,false)">âœ— <span id="lbl-no1">Ø®Ø·Ø£</span></button>
        </div>
      </div>
      <div>
        <div class="team-ctrl-lbl" id="ctrl-p2-lbl">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</div>
        <div class="team-btns">
          <button class="ctrl-btn btn-correct" id="b-p2-ok" onclick="markAnswer(1,true)">âœ“ <span id="lbl-ok2">ØµØ­</span></button>
          <button class="ctrl-btn btn-wrong"   id="b-p2-no" onclick="markAnswer(1,false)">âœ— <span id="lbl-no2">Ø®Ø·Ø£</span></button>
        </div>
      </div>
    </div>
    <div style="text-align:center">
      <button class="btn-secondary" style="font-size:12px;padding:7px 16px" onclick="goSetup()"><span id="lbl-edit">â† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span></button>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-box">
    <h2 id="ro-title">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©</h2>
    <p id="ro-msg"></p>
    <div class="score-disp">
      <div class="sd-item"><div class="sd-name" id="ro-p1n">â€”</div><div class="sd-pts" id="ro-p1p">0</div></div>
      <div class="sd-sep">:</div>
      <div class="sd-item"><div class="sd-pts" id="ro-p2p">0</div><div class="sd-name" id="ro-p2n">â€”</div></div>
    </div>
    <div class="overlay-btns">
      <button class="btn-secondary" style="flex:1" onclick="closeOverlay();goSetup()"><span id="lbl-newcard">Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</span></button>
      <button class="btn-primary" style="flex:1;padding:11px" onclick="closeOverlay();replayCard()"><span id="lbl-replay">Ù†ÙØ³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span></button>
    </div>
  </div>
</div>

<div class="save-toast" id="save-toast">âœ“</div>

<script>
// â”€â”€ TRANSLATIONS â”€â”€
const TX={
ar:{
  heroTitle:'Ø¬ÙˆÙ„Ø© <span>Ø§Ù„Ø£Ø±Ø´ÙŠÙ</span>',heroSub:'The Archive Round',
  secPlayers:'Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³Ø©',secMatch:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©',
  secHev:'Ø£Ù‡Ø¯Ø§Ù ÙˆØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¶ÙŠÙ',secAev:'Ø£Ù‡Ø¯Ø§Ù ÙˆØªÙ…Ø±ÙŠØ±Ø§Øª Ø§Ù„Ø¶ÙŠÙ',secTarget:'Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
  p1:'Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„',p2:'Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ',
  home:'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¶ÙŠÙ',away:'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¶ÙŠÙ',
  hscore:'Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¶ÙŠÙ',ascore:'Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¶ÙŠÙ',season:'Ø§Ù„Ù…ÙˆØ³Ù…',league:'Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©',
  addEv:'Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù / ØªÙ…Ø±ÙŠØ±Ø©',
  ttype:'Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„',tnum:'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø¯Ù',tteam:'Ù„Ø£ÙŠ ÙØ±ÙŠÙ‚ØŸ',tcustom:'Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„',tans:'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ù„Ù„Ù…Ø¶ÙŠÙ ÙÙ‚Ø·)',
  optScored:'Ù…Ù† Ø³Ø¬Ù‘Ù„ØŸ',optAssisted:'Ù…Ù† ØµÙ†Ø¹ØŸ',optCustom:'Ø³Ø¤Ø§Ù„ Ù…Ø®ØµØµ',
  optHome:'Ø§Ù„Ù…Ø¶ÙŠÙ',optAway:'Ø§Ù„Ø¶ÙŠÙ',
  lblTid:'Ø±Ù‚Ù… Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (#ID)',secSaved:'Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',lblSave:'Ø­ÙØ¸',
  create:'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡',
  roundLbl:'Ø§Ù„Ø¬ÙˆÙ„Ø©',timerStart:'Ø§Ø¨Ø¯Ø£',timerStop:'Ø¥ÙŠÙ‚Ø§Ù',revall:'ÙƒØ´Ù Ø§Ù„ÙƒÙ„',
  ok:'ØµØ­',no:'Ø®Ø·Ø£',editCard:'â† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
  newCard:'Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©',replay:'Ù†ÙØ³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©',
  lblLeague:'Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©',lblSeason:'Ø§Ù„Ù…ÙˆØ³Ù…',lblResult:'Ø§Ù„Ù†ØªÙŠØ¬Ø©',lblTarget:'Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', lblAnswer: 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©',
  statusReady:'Ø¯ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ù„Ø¹Ø¨...',statusTiming:'Ø§Ù„ÙˆÙ‚Øª ÙŠØ¹Ù…Ù„...',
  roTitle:'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©',roNobody:'Ù„Ù… ÙŠØ¬Ø¨ Ø£Ø­Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­',
  roCorrect:(n,p)=>`Ø£Ø¬Ø§Ø¨ ${n} Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­! (+${p} Ù†Ù‚Ø·Ø©)`,
  noEvents:'â€”',lbl_G:'Ù‡Ø¯Ù',lbl_A:'ØªÙ…Ø±ÙŠØ±Ø©',
  tq_scored:(team,n)=>`Ù…Ù† Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù‡Ø¯Ù Ø±Ù‚Ù… ${n} Ù„Ù€ ${team}ØŸ`,
  tq_assisted:(team,n)=>`Ù…Ù† ØµÙ†Ø¹ Ø§Ù„Ù‡Ø¯Ù Ø±Ù‚Ù… ${n} Ù„Ù€ ${team}ØŸ`,
  errFill:'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚ ÙˆØ§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
  phPlayer:'Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨',phMin:'Ø¯',phHome:'Ù…Ø«Ø§Ù„: Ø§Ù„Ø§ØªØ­Ø§Ø¯',phAway:'Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ù‡Ù„ÙŠ',
  phLeague:'Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±ÙŠ Ø±ÙˆØ´Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',phSeason:'2024/2023',phP1:'Ù…Ø«Ø§Ù„: Ø§Ù„Ù‡Ù„Ø§Ù„',phP2:'Ù…Ø«Ø§Ù„: Ø§Ù„Ù†ØµØ±',
},
en:{
  heroTitle:'The <span>Archive</span>',heroSub:'Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ',
  secPlayers:'Competing Teams',secMatch:'Match Info',
  secHev:'Home Goals & Assists',secAev:'Away Goals & Assists',secTarget:'Target Question',
  p1:'Team 1 Name',p2:'Team 2 Name',
  home:'Home Team',away:'Away Team',
  hscore:'Home Goals',ascore:'Away Goals',season:'Season',league:'League',
  addEv:'Add Goal / Assist',
  ttype:'Question Type',tnum:'Goal Number',tteam:'Which Team?',tcustom:'Question Text',tans:'Correct Answer (host only)',
  optScored:'Who scored?',optAssisted:'Who assisted?',optCustom:'Custom question',
  optHome:'Home',optAway:'Away',
  lblTid:'Target Event ID (#ID)',secSaved:'Saved Rounds',lblSave:'Save',
  create:'Create Card & Start',
  roundLbl:'Round',timerStart:'Start',timerStop:'Stop',revall:'Reveal All',
  ok:'âœ“',no:'âœ—',editCard:'â† Edit Card',
  newCard:'New Card',replay:'Same Card',
  lblLeague:'League',lblSeason:'Season',lblResult:'Result',lblTarget:'Target', lblAnswer: 'Answer',
  statusReady:'Team turn...',statusTiming:'Timer running...',
  roTitle:'Round Over',roNobody:'Nobody answered correctly',
  roCorrect:(n,p)=>`${n} answered correctly! (+${p} pts)`,
  noEvents:'â€”',lbl_G:'G',lbl_A:'A',
  tq_scored:(team,n)=>`Who scored goal #${n} for ${team}?`,
  tq_assisted:(team,n)=>`Who assisted goal #${n} for ${team}?`,
  errFill:'Please fill in team names and league at minimum',
  phPlayer:'Player name',phMin:'min',phHome:'e.g. Al-Ittihad',phAway:'e.g. Al-Ahli',
  phLeague:'e.g. Saudi Pro League',phSeason:'2023/2024',phP1:'e.g. Al-Hilal',phP2:'e.g. Al-Nassr',
}};

let lang='ar';
let G={};
let timerIv=null,timerSec=30,timerOn=false;

const t=(k,...a)=>{const v=TX[lang][k];return typeof v==='function'?v(...a):v??k;};
const $=(id)=>document.getElementById(id);

// â”€â”€ LANG â”€â”€
function toggleLang(){
  lang=lang==='ar'?'en':'ar';
  document.documentElement.lang=lang;
  document.documentElement.dir=lang==='ar'?'rtl':'ltr';
  document.body.classList.toggle('ltr',lang!=='ar');
  applyTX();updateTargetPreview();
}
function applyTX(){
  const s=(id,k)=>{const e=$(id);if(e)e.innerHTML=t(k);};
  const p=(id,k)=>{const e=$(id);if(e)e.placeholder=t(k);};
  s('hero-title','heroTitle');s('hero-sub','heroSub');
  s('sec-players','secPlayers');s('sec-match','secMatch');
  s('sec-hev','secHev');s('sec-aev','secAev');s('sec-target','secTarget');
  s('lbl-p1','p1');s('lbl-p2','p2');s('lbl-home','home');s('lbl-away','away');
  s('lbl-hscore','hscore');s('lbl-ascore','ascore');s('lbl-season','season');s('lbl-league','league');
  s('lbl-addhome','addEv');s('lbl-addaway','addEv');
  s('lbl-ttype','ttype');s('lbl-tnum','tnum');s('lbl-tteam','tteam');
  s('lbl-tcustom','tcustom');s('lbl-tans','tans');
  s('opt-scored','optScored');s('opt-assisted','optAssisted');s('opt-custom','optCustom');
  s('opt-thome','optHome');s('opt-taway','optAway');
  s('lbl-create','create');s('lbl-round','roundLbl');
  s('lbl-tbtn','timerStart');s('lbl-revall','revall');
  s('lbl-ok1','ok');s('lbl-no1','no');s('lbl-ok2','ok');s('lbl-no2','no');
  s('lbl-edit','editCard');s('lbl-newcard','newCard');s('lbl-replay','replay');
  s('sec-target','secTarget');s('lbl-tid','lblTid');
  s('sec-saved','secSaved');s('lbl-save','lblSave');
  p('inp-home','phHome');p('inp-away','phAway');p('inp-league','phLeague');
  p('inp-season','phSeason');p('inp-p1','phP1');p('inp-p2','phP2');
  renderSavedRounds();
  updateTargetPreview();
}

// â”€â”€ EVENTS BUILDER â”€â”€
let evNextId = 1;

function addEvent(side){
  const gid = evNextId++;
  const div = document.createElement('div');
  div.className='event-item'; div.id=`ev-${side}-${gid}`; div.dataset.gid=gid; div.dataset.side=side;
  div.innerHTML=`
    <div class="ev-id-badge">#${gid}</div>
    <div class="ev-badge G" id="eb-${gid}" onclick="toggleType(${gid})">G</div>
    <input type="text" placeholder="${t('phPlayer')}" id="ep-${gid}" style="padding:8px 10px;font-size:13px">
    <input type="text" placeholder="${t('phMin')}"    id="em-${gid}" style="padding:8px 6px;font-size:13px;text-align:center">
    <button class="btn-danger" onclick="rmEvent('${side}',${gid})">âœ•</button>`;
  $(`list-${side}`).appendChild(div);
  updateTargetPreview();
}
function addEventWithId(side, gid, type, player, minute){
  if(gid >= evNextId) evNextId = gid + 1;
  const div = document.createElement('div');
  div.className='event-item'; div.id=`ev-${side}-${gid}`; div.dataset.gid=gid; div.dataset.side=side;
  div.innerHTML=`
    <div class="ev-id-badge">#${gid}</div>
    <div class="ev-badge ${type}" id="eb-${gid}" onclick="toggleType(${gid})">${type}</div>
    <input type="text" placeholder="${t('phPlayer')}" id="ep-${gid}" value="${player}" style="padding:8px 10px;font-size:13px">
    <input type="text" placeholder="${t('phMin')}"    id="em-${gid}" value="${minute}" style="padding:8px 6px;font-size:13px;text-align:center">
    <button class="btn-danger" onclick="rmEvent('${side}',${gid})">âœ•</button>`;
  $(`list-${side}`).appendChild(div);
}
function toggleType(gid){
  const b=$(`eb-${gid}`);
  const isG=b.classList.contains('G');
  b.classList.toggle('G',!isG); b.classList.toggle('A',isG);
  b.textContent=isG?'A':'G';
}
function rmEvent(side,gid){ const e=$(`ev-${side}-${gid}`); if(e)e.remove(); updateTargetPreview(); }
function getEvents(side){
  return [...$(`list-${side}`).querySelectorAll('.event-item')]
    .map(el=>{
      const gid=parseInt(el.dataset.gid);
      const player=$(`ep-${gid}`).value.trim();
      const min=$(`em-${gid}`).value.trim();
      if(!player) return null;
      return{gid, type:$(`eb-${gid}`).classList.contains('G')?'G':'A', player, minute:min, side};
    }).filter(Boolean);
}
function getAllEvents(){ return [...getEvents('home'),...getEvents('away')]; }

// â”€â”€ TARGET PREVIEW â”€â”€
function updateTargetPreview(){
  const tid=parseInt($('inp-tid')?.value);
  const el=$('target-preview'); if(!el) return;
  if(!tid){ el.textContent=lang==='ar'?'Ø£Ø¶Ù Ø£Ø­Ø¯Ø§Ø«Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø«Ù… Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù':'Add events above then enter the target event ID'; return; }
  const ev=getAllEvents().find(e=>e.gid===tid);
  if(!ev){ el.textContent=lang==='ar'?`âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¯Ø« Ø¨Ø±Ù‚Ù… #${tid}`:`âŒ No event with ID #${tid}`; return; }
  const teamName=ev.side==='home'?($('inp-home').value||t('optHome')):($('inp-away').value||t('optAway'));
  const typeStr=ev.type==='G'?(lang==='ar'?'Ù‡Ø¯Ù':'Goal'):(lang==='ar'?'ØªÙ…Ø±ÙŠØ±Ø©':'Assist');
  el.textContent=`âœ“  #${tid} â€” ${typeStr}: ${ev.player}  (${teamName})`;
}

// â”€â”€ START GAME â”€â”€
function startGame(){
  const p1=$('inp-p1').value.trim(), p2=$('inp-p2').value.trim();
  const home=$('inp-home').value.trim(), away=$('inp-away').value.trim();
  const league=$('inp-league').value.trim();
  if(!p1||!p2||!home||!away||!league){alert(t('errFill'));return;}

  const tid=parseInt($('inp-tid').value);
  const targetEv=getAllEvents().find(e=>e.gid===tid);
  if(!targetEv){alert(lang==='ar'?'Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø­Ø¯Ø« ØµØ­ÙŠØ­ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨':'Enter a valid event ID in the target section');return;}

  const hs=parseInt($('inp-hscore').value)||0, as=parseInt($('inp-ascore').value)||0;
  const season=$('inp-season').value.trim();
  const homeEvents=getEvents('home'), awayEvents=getEvents('away');

  G={p1,p2,home,away,score:`${hs} - ${as}`,season,league,
     homeEvents,awayEvents,targetGid:tid,targetAnswer:targetEv.player,
     squares:[],revealed:new Set(),
     pts:[0,0],strikes:[0,0],eliminated:[false,false],roundActive:true,currentTurn:0};

  buildSquares();
  renderGameHeader();
  renderCard();
  resetTimer();
  updateTurnUI();
  updateCtrlBtns();
  $('status-bar').textContent=t('statusReady');
  $('status-bar').className='status-bar';
  $('overlay').classList.remove('show');
  goTo('game');
}

// â”€â”€ SQUARES â”€â”€
function buildSquares(){
  const sq=[]; let n=0;
  const mk=(type,value,meta={})=>sq.push({id:++n,type,value,meta});
  mk('league',G.league);
  mk('season',G.season||'â€”');
  mk('team-home',G.home);
  mk('team-away',G.away);
  mk('score',G.score);
  mk('answer',G.targetAnswer); // Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ â€” openable by host, shows answer
  G.homeEvents.forEach(e=>mk('event-home',e.player,{type:e.type,minute:e.minute,gid:e.gid,locked:e.gid===G.targetGid}));
  G.awayEvents.forEach(e=>mk('event-away',e.player,{type:e.type,minute:e.minute,gid:e.gid,locked:e.gid===G.targetGid}));
  G.squares=sq; G.revealed=new Set();
}

// â”€â”€ RENDER CARD â”€â”€
const isRev=id=>G.revealed.has(id);

function rInfo(sq){
  const cls=sq.type==='league'?'sq-c-league':'sq-c-season';
  return isRev(sq.id)
    ?`<span class="sq revealed sq-info">${sq.value}</span>`
    :`<span class="sq hidden sq-info ${cls}" onclick="revSq(${sq.id})">${sq.id}</span>`;
}
function rTeam(sq){
  return isRev(sq.id)
    ?`<div class="sq revealed sq-team cteam"><div class="cteam-name">${sq.value}</div></div>`
    :`<div class="sq hidden sq-team sq-c-team" onclick="revSq(${sq.id})">${sq.id}</div>`;
}
function rScore(sq){
  return isRev(sq.id)
    ?`<div class="sq revealed sq-score cscore-wrap"><div class="cscore-lbl">${t('lblResult')}</div><div class="cscore-val">${sq.value}</div></div>`
    :`<div class="sq hidden sq-score sq-c-score" onclick="revSq(${sq.id})">${sq.id}</div>`;
}
function rAnswer(sq){
  return isRev(sq.id)
    ?`<div class="sq revealed sq-target" style="justify-content:center;color:var(--accent);font-weight:700;font-size:15px;text-align:center">${sq.value}</div>`
    :`<div class="sq hidden sq-target sq-c-answer" onclick="revSq(${sq.id})" style="justify-content:center;font-size:20px">?</div>`;
}
function rEvent(sq){
  if(isRev(sq.id)){
    return `<div class="sq revealed sq-event">
      <span class="ev-type ${sq.meta.type}">${t('lbl_'+sq.meta.type)}</span>
      <span class="ev-player">${sq.value}</span>
      <span class="ev-min">${sq.meta.minute?sq.meta.minute+"'":''}</span>
    </div>`;
  }
  if(sq.meta.locked){
    return `<div class="sq locked sq-event" title="${lang==='ar'?'Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨':'This is the target'}">?</div>`;
  }
  const cls=sq.meta.type==='G'?'sq-c-goal':'sq-c-assist';
  return `<div class="sq hidden sq-event ${cls}" onclick="revSq(${sq.id})">${sq.id}</div>`;
}

function renderCard(){
  const leag=G.squares.find(s=>s.type==='league');
  const seas=G.squares.find(s=>s.type==='season');
  const hteam=G.squares.find(s=>s.type==='team-home');
  const ateam=G.squares.find(s=>s.type==='team-away');
  const score=G.squares.find(s=>s.type==='score');
  const ansSq=G.squares.find(s=>s.type==='answer');
  const hEv=G.squares.filter(s=>s.type==='event-home');
  const aEv=G.squares.filter(s=>s.type==='event-away');
  const hEvHtml=hEv.length?hEv.map(rEvent).join(''):`<div class="no-events">${t('noEvents')}</div>`;
  const aEvHtml=aEv.length?aEv.map(rEvent).join(''):`<div class="no-events">${t('noEvents')}</div>`;

  $('match-card').innerHTML=`
    <div class="card-meta">
      <div class="cmeta-cell"><span class="cmeta-label">${t('lblLeague')}</span>${rInfo(leag)}</div>
      <div class="cmeta-cell"><span class="cmeta-label">${t('lblSeason')}</span>${rInfo(seas)}</div>
    </div>
    <div class="card-teams">${rTeam(hteam)}${rScore(score)}${rTeam(ateam)}</div>
    <div class="card-target"><div class="ctarget-lbl">${t('lblTarget')}</div>${rAnswer(ansSq)}</div>
    <div class="card-events">
      <div class="cevents-col">${hEvHtml}</div>
      <div class="cevents-col">${aEvHtml}</div>
    </div>`;
}

function revSq(id){
  if(!G.roundActive||G.revealed.has(id))return;
  const sq=G.squares.find(s=>s.id===id);
  if(sq&&sq.meta&&sq.meta.locked)return; // target event is locked â€” cannot be opened
  G.revealed.add(id);renderCard();
  switchTurn(); // switches active team and restarts timer
}
function revealAll(){
  G.squares.forEach(s=>G.revealed.add(s.id));renderCard();stopTimer();
  if(G.roundActive){G.roundActive=false; updateTurnUI(); setTimeout(()=>showOverlay(false),400);}
}

// â”€â”€ TEAM TURNS â”€â”€
function updateTurnUI(){
  if(!G.roundActive) {
    $('tsb-p1').classList.remove('active-turn');
    $('tsb-p2').classList.remove('active-turn');
    return;
  }
  $('tsb-p1').classList.toggle('active-turn', G.currentTurn === 0);
  $('tsb-p2').classList.toggle('active-turn', G.currentTurn === 1);
}

function switchTurn() {
  if (!G.roundActive) return;
  if (G.eliminated[0] && G.eliminated[1]) return;
  G.currentTurn = G.currentTurn === 0 ? 1 : 0;
  if (G.eliminated[G.currentTurn]) G.currentTurn = G.currentTurn === 0 ? 1 : 0; // Skip if eliminated
  updateTurnUI();
  resetTimer();
  startTmr();
}

// â”€â”€ GAME HEADER â”€â”€
function renderGameHeader(){
  $('gh-p1').textContent=G.p1;$('gh-p2').textContent=G.p2;
  $('ctrl-p1-lbl').textContent=G.p1;$('ctrl-p2-lbl').textContent=G.p2;
  $('ro-p1n').textContent=G.p1;$('ro-p2n').textContent=G.p2;
  updateScore();
}
function updateScore(){
  $('gh-p1-pts').textContent=G.pts[0];$('gh-p2-pts').textContent=G.pts[1];
  $('ro-p1p').textContent=G.pts[0];$('ro-p2p').textContent=G.pts[1];
  [0,1].forEach(i=>{
    const el=$(i===0?'gh-p1-str':'gh-p2-str');el.innerHTML='';
    for(let j=0;j<2;j++){const d=document.createElement('div');d.className='sdot'+(j<G.strikes[i]?' hit':'');el.appendChild(d);}
  });
}
function updateCtrlBtns(){
  [0,1].forEach(i=>{
    const dis=G.eliminated[i]||!G.roundActive;
    $(i===0?'b-p1-ok':'b-p2-ok').disabled=dis;
    $(i===0?'b-p1-no':'b-p2-no').disabled=dis;
  });
}

// â”€â”€ TIMER â”€â”€
function resetTimer(){
  stopTimer();timerSec=30;
  $('timer').textContent='30';$('timer').className='timer';
  $('lbl-tbtn').textContent=t('timerStart');
}
function toggleTimer(){timerOn?stopTimer():startTmr();}
function startTmr(){
  if(!G.roundActive)return;
  timerOn=true;$('lbl-tbtn').textContent=t('timerStop');
  $('status-bar').textContent=t('statusTiming');$('status-bar').className='status-bar on';
  timerIv=setInterval(()=>{
    timerSec--;$('timer').textContent=timerSec;
    if(timerSec<=10)$('timer').classList.add('warn');
    if(timerSec<=0){stopTimer();$('timer').textContent='0'; setTimeout(switchTurn,400);}
  },1000);
}
function stopTimer(){
  if(timerIv){clearInterval(timerIv);timerIv=null;}
  timerOn=false;
  const b=$('lbl-tbtn');if(b)b.textContent=t('timerStart');
}

// â”€â”€ ANSWERS â”€â”€
function markAnswer(ti,correct){
  if(!G.roundActive||G.eliminated[ti])return;
  stopTimer();resetTimer();
  if(correct){
    const hidden=G.squares.length-G.revealed.size;
    G.pts[ti]+=hidden;G.roundActive=false;
    updateScore();updateTurnUI();revealAll();
    setTimeout(()=>showOverlay(true,ti,hidden),500);
  } else {
    G.strikes[ti]++;
    if(G.strikes[ti]>=2)G.eliminated[ti]=true;
    updateScore();updateCtrlBtns();
    if(G.eliminated[0]&&G.eliminated[1]){
       G.roundActive=false;updateTurnUI();revealAll();
       setTimeout(()=>showOverlay(false),500);
    } else {
       switchTurn();
    }
  }
}

function showOverlay(win,ti,pts){
  $('ro-title').textContent=t('roTitle');
  $('ro-msg').innerHTML=win
    ?`<span style="color:var(--accent)">${ti===0?G.p1:G.p2}</span> â€” ${t('roCorrect',ti===0?G.p1:G.p2,pts).split('â€”')[1]||t('roCorrect',ti===0?G.p1:G.p2,pts)}`
    :t('roNobody');
  if(win) $('ro-msg').innerHTML=`<span style="color:var(--accent)">${ti===0?G.p1:G.p2}</span> ${t('roCorrect','',pts).replace('  ',' ')}`;
  $('overlay').classList.add('show');
}
function closeOverlay(){$('overlay').classList.remove('show');}

function replayCard(){
  G.strikes=[0,0];G.eliminated=[false,false];G.roundActive=true;G.currentTurn=0;
  buildSquares(); // rebuild so locked squares reset properly
  renderCard();resetTimer();updateTurnUI();updateCtrlBtns();
  $('status-bar').textContent=t('statusReady');$('status-bar').className='status-bar';
}

// â”€â”€ NAV â”€â”€
function goTo(v){document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));$('view-'+v).classList.add('active');}
function goSetup(){stopTimer();goTo('setup');}

// â”€â”€ SAVED ROUNDS â”€â”€
const STORAGE_KEY='archive_rounds';
function getRounds(){try{const r=localStorage.getItem(STORAGE_KEY);return r?JSON.parse(r):[]}catch(e){return[]}}
function setRounds(r){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(r))}catch(e){}}
function showToast(msg){const el=$('save-toast');el.textContent=msg;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),2000);}

function saveRound(){
  const home=$('inp-home').value.trim(),away=$('inp-away').value.trim(),league=$('inp-league').value.trim();
  if(!home||!away||!league){alert(t('errFill'));return;}
  const tid=parseInt($('inp-tid').value);
  if(!tid||!getAllEvents().find(e=>e.gid===tid)){alert(lang==='ar'?'Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø­Ø¯Ø« ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹':'Choose a valid event ID first');return;}
  const round={
    id:Date.now(), savedAt:new Date().toLocaleDateString(lang==='ar'?'ar-SA':'en-GB'),
    p1:$('inp-p1').value.trim(), p2:$('inp-p2').value.trim(),
    home, away, league, season:$('inp-season').value.trim(),
    hscore:$('inp-hscore').value, ascore:$('inp-ascore').value,
    homeEvents:getEvents('home'), awayEvents:getEvents('away'),
    evNextId, targetId:tid,
  };
  const rounds=getRounds(); rounds.unshift(round); setRounds(rounds);
  renderSavedRounds();
  showToast(lang==='ar'?'âœ“ ØªÙ… Ø§Ù„Ø­ÙØ¸':'âœ“ Saved');
}

function loadRound(id){
  const r=getRounds().find(x=>x.id===id); if(!r)return;
  $('inp-p1').value=r.p1||''; $('inp-p2').value=r.p2||'';
  $('inp-home').value=r.home||''; $('inp-away').value=r.away||'';
  $('inp-league').value=r.league||''; $('inp-season').value=r.season||'';
  $('inp-hscore').value=r.hscore??0; $('inp-ascore').value=r.ascore??0;
  $('list-home').innerHTML=''; $('list-away').innerHTML='';
  evNextId=1;
  (r.homeEvents||[]).forEach(e=>addEventWithId('home',e.gid,e.type,e.player,e.minute||''));
  (r.awayEvents||[]).forEach(e=>addEventWithId('away',e.gid,e.type,e.player,e.minute||''));
  if(r.evNextId) evNextId=r.evNextId;
  $('inp-tid').value=r.targetId||'';
  updateTargetPreview();
  $('view-setup').scrollTo({top:0,behavior:'smooth'});
  showToast(lang==='ar'?'âœ“ ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„':'âœ“ Loaded');
}

function deleteRound(id){
  setRounds(getRounds().filter(x=>x.id!==id)); renderSavedRounds();
}

function renderSavedRounds(){
  const rounds=getRounds();
  const sec=$('saved-section'),list=$('saved-list'),count=$('saved-count');
  if(!sec)return;
  if(rounds.length===0){sec.style.display='none';return;}
  sec.style.display=''; count.textContent=`(${rounds.length})`;
  list.innerHTML='';
  rounds.forEach(r=>{
    const div=document.createElement('div'); div.className='saved-card';
    div.innerHTML=`
      <div class="saved-card-info">
        <div class="saved-card-title">${r.home} vs ${r.away}</div>
        <div class="saved-card-meta">${r.league}${r.season?' Â· '+r.season:''} Â· ${r.hscore}-${r.ascore} Â· ${r.savedAt}</div>
      </div>
      <div class="saved-card-btns">
        <button class="btn-load" onclick="loadRound(${r.id})">${lang==='ar'?'ØªØ­Ù…ÙŠÙ„':'Load'}</button>
        <button class="btn-danger" onclick="deleteRound(${r.id})">âœ•</button>
      </div>`;
    list.appendChild(div);
  });
}

// â”€â”€ INIT â”€â”€
applyTX();
</script>
</body>
</html>